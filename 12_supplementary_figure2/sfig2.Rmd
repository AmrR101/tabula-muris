---
title: "Supplementary Figure 2"
output: html_document
---

```{r}
library(tidyverse)
library(stringr)
library(Seurat)
library(scales)
```

Load the processed and annotated data.

```{r}
#load(file=here("00_data_ingest", "11_global_robj", "FACS_all.Robj"))
#load(file=here("00_data_ingest", "11_global_robj", "droplet_all.Robj"))
```

```{r}
plate_v_tenx <- function(tissue_var, annotation_var){
  cells_FACS <- tiss_FACS@meta.data %>% filter(cell_ontology_class == annotation_var & tissue == tissue_var) %>% 
    pull(cell)
  pct_FACS <- Matrix::rowMeans(tiss_FACS@raw.data[,cells_FACS] > 0)
  
  cells_droplet <- tiss_droplet@meta.data %>% filter(cell_ontology_class == annotation_var & tissue == tissue_var) %>% 
    pull(cell)
  pct_tenx <- Matrix::rowMeans(tiss_droplet@raw.data[,cells_droplet] > 0)
  
  pct1 = as_data_frame(pct_tenx)
  pct1['gene'] <- names(pct_tenx)
  pct1['method'] <- 'droplet'
  pct1 <- filter(pct1, value > 0.01)
  
  pct2 = as_data_frame(pct_FACS)
  pct2['gene'] <- names(pct_FACS)
  pct2['method'] <- 'FACS'
  pct2 <- filter(pct2, value > 0.01)
  
  pct <- bind_rows(pct1, pct2)
  
  pct  %>% spread(key = method, value = value, fill = 0) %>% 
    ggplot(aes(x = FACS, y = droplet)) + geom_point(color = 'blue', alpha = 0.1) + geom_abline(slope=1, intercept=0)  +
      scale_fill_continuous(trans = log10_trans())
}
```

```{r}
plate_v_tenx("Liver", "hepatocyte") + ggtitle("Liver hepatocytes")
ggsave(here("13_supplementary_figure3","sfigure3-hep.pdf"), width = 7, height = 7, units = "in")
```

```{r}
# Streaking caused by finiteness: only 65 cells means percent is visibly discrete.

plate_v_tenx("Kidney", "fibroblast") + ggtitle("Kidney fibroblasts")
ggsave(here("13_supplementary_figure3","sfigure3-fib.pdf"), width = 7, height = 7, units = "in")
```

```{r}
plate_v_tenx("Spleen", "B cell") + ggtitle("Spleen B Cells")
ggsave(here("13_supplementary_figure3","sfigure3-b.pdf"), width = 7, height = 7, units = "in")
```
